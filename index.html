<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dispatch System</title>
  <style>
    :root {
      --primary: #4a6fa5;
      --secondary: #166088;
      --light: #f8f9fa;
      --dark: #212529;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--light);
      color: var(--dark);
      padding: 20px;
      transition: all 0.3s;
    }

    body.dark-mode {
      background-color: #121212;
      color: #f0f0f0;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    input, select, button, textarea {
      padding: 10px;
      margin: 8px 0;
      border-radius: 5px;
      border: 1px solid #ddd;
      width: 100%;
      max-width: 300px;
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    button {
      background-color: var(--primary);
      color: white;
      border: none;
      cursor: pointer;
      margin-right: 10px;
    }

    button:hover {
      background-color: var(--secondary);
    }

    .button-group {
      margin-top: 15px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: left;
    }

    th {
      background-color: var(--primary);
      color: white;
    }

    .product-list {
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #ddd;
      padding: 10px;
      margin: 10px 0;
    }

    .product-item {
      margin: 5px 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .product-item button {
      background-color: transparent;
      color: red;
      border: none;
      font-size: 1rem;
      cursor: pointer;
    }

    @media print {
      body * {
        visibility: hidden;
      }
      #recordsTable, #recordsTable * {
        visibility: visible;
      }
      #recordsTable {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Dispatch System</h2>
    <button onclick="toggleDarkMode()">üåô Toggle Dark Mode</button>

    <form id="dispatchForm">
      <label for="date">Date:</label>
      <input type="date" id="date" required>

      <label for="Transport">Transport Name:</label>
      <input type="text" id="Transport" placeholder="Transport Name" required>

      <h3>Products</h3>
      <div class="product-list" id="productChecklist"></div>

      <label for="newProduct">Add New Product:</label>
      <input type="text" id="newProduct" placeholder="New Product Name">
      <button type="button" onclick="addProduct()">‚ûï Add Product</button><br>

      <label for="quantity">Quantity:</label>
      <input type="number" id="quantity" placeholder="Quantity" required>

      <label for="destination">Dispatched To:</label>
      <input type="text" id="destination" placeholder="Dispatched To" required>

      <label for="description">Description:</label>
      <textarea id="description" placeholder="Description"></textarea>

      <div class="button-group">
        <button type="submit">‚úÖ Save</button>
        <button type="button" onclick="clearForm()">üßπ Clear</button>
        <button type="button" onclick="printTable()">üñ®Ô∏è Print</button>
        <button type="button" onclick="exportToTXT()">üì• Export</button>
      </div>
    </form>

    <h3>Records</h3>
    <table id="recordsTable">
      <thead>
        <tr>
          <th>Date</th>
          <th>Vehicle</th>
          <th>Materials</th>
          <th>Quantity</th>
          <th>Destination</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    let products = JSON.parse(localStorage.getItem('products')) || [
      "18000CMH Top Disc.",
      "18000CMH Bottom Disc.",
      "25000CMH Top Disc.",
      "25000CMH Bottom Disc."
    ];

    let records = JSON.parse(localStorage.getItem('records')) || [];

    window.onload = function() {
      loadProducts();
      loadRecords();
    };

    function loadProducts() {
      const container = document.getElementById('productChecklist');
      container.innerHTML = products.map((product, index) => `
        <div class="product-item">
          <label>
            <input type="checkbox" id="prod_${product}" name="products" value="${product}">
            ${product}
          </label>
          <button onclick="deleteProduct(${index})" title="Delete Product">‚úñ</button>
        </div>
      `).join('');
    }

    function addProduct() {
      const input = document.getElementById('newProduct');
      const newProduct = input.value.trim();
      if (newProduct && !products.some(p => p.toLowerCase() === newProduct.toLowerCase())) {
        products.push(newProduct);
        localStorage.setItem('products', JSON.stringify(products));
        loadProducts();
        input.value = '';
      } else if (!newProduct) {
        alert("Please enter a product name.");
      } else {
        alert("Product already exists.");
      }
    }

    function deleteProduct(index) {
      if (confirm("Are you sure you want to delete this product?")) {
        products.splice(index, 1);
        localStorage.setItem('products', JSON.stringify(products));
        loadProducts();
      }
    }

    function loadRecords() {
      const tbody = document.querySelector('#recordsTable tbody');
      tbody.innerHTML = records.map(record => `
        <tr>
          <td>${record.date}</td>
          <td>${record.vehicle}</td>
          <td>${record.materials}</td>
          <td>${record.quantity}</td>
          <td>${record.destination}</td>
          <td>${record.description}</td>
        </tr>
      `).join('');
    }

    document.getElementById('dispatchForm').addEventListener('submit', function(e) {
      e.preventDefault();

      const selectedProducts = Array.from(
        document.querySelectorAll('input[name="products"]:checked')
      ).map(el => el.value);

      const date = document.getElementById('date').value;
      const vehicle = document.getElementById('Transport').value;
      const quantity = document.getElementById('quantity').value;
      const destination = document.getElementById('destination').value;

      if (!date || !vehicle || !quantity || !destination) {
        alert("Please fill in all required fields.");
        return;
      }

      if (selectedProducts.length === 0) {
        alert("Please select at least one product.");
        return;
      }

      const record = {
        date,
        vehicle,
        materials: selectedProducts.join(", "),
        quantity,
        destination,
        description: document.getElementById('description').value
      };

      records.push(record);
      localStorage.setItem('records', JSON.stringify(records));
      loadRecords();
      clearForm();
    });

    function clearForm() {
      if (confirm("Clear the form? All unsaved data will be lost.")) {
        document.getElementById('dispatchForm').reset();
        document.querySelectorAll('input[name="products"]').forEach(cb => cb.checked = false);
      }
    }

    function printTable() {
      window.print();
    }

    function exportToTXT() {
      let content = "Dispatch Records\n\n";
      records.forEach(record => {
        content += `Date: ${record.date}\n`;
        content += `Vehicle: ${record.vehicle}\n`;
        content += `Materials: ${record.materials}\n`;
        content += `Quantity: ${record.quantity}\n`;
        content += `Destination: ${record.destination}\n`;
        content += `Description: ${record.description}\n\n`;
      });

      const blob = new Blob([content], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `dispatch_${new Date().toISOString().slice(0,10)}.txt`;
      a.click();
      URL.revokeObjectURL(url);
    }

    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
    }
  </script>
</body>
</html>
